@page "/"
@using System.ComponentModel.DataAnnotations
@using MudBlazor
@inject ISnackbar Snackbar
@inject NavigationManager NavigationManager

@* NOTE: I removed '@rendermode InteractiveServer' from here because 
   it is already set globally in your App.razor. Having it in both places causes a crash.
*@

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="d-flex align-start justify-center" Style="min-height: 100vh; background-image: linear-gradient(to bottom right, #f0fdfa, #ffffff, #f0fdfa); padding-top: 5rem; padding-left: 1rem; padding-right: 1rem; padding-bottom: 1rem;">

    <MudCard Elevation="20" Class="w-100" Style="max-width: 28rem;">

        <MudCardHeader Class="pa-6">
            <CardHeaderContent>
                <MudText Typo="Typo.h5" Align="Align.Center" Class="font-weight-bold">Log In</MudText>
                <MudText Typo="Typo.body1" Align="Align.Center" Class="mud-text-secondary">
                    Enter your credentials to access your account
                </MudText>
            </CardHeaderContent>
        </MudCardHeader>

        <MudCardContent Class="pa-6 pt-0">
            @* FIX: Removed the commented out OnValidSubmit attribute that was causing the crash *@
            <EditForm Model="@model" FormName="LoginForm">
                <DataAnnotationsValidator />

                <MudGrid Spacing="2">

                    <MudItem xs="12">
                        <MudTextField Label="Username"
                                      Placeholder="Your Username or Email"
                                      Variant="Variant.Outlined"
                                      InputType="InputType.Email"
                                      @bind-Value="model.Username"
                                      For="@(() => model.Username)"
                                      Required="true" />
                    </MudItem>

                    <MudItem xs="12">
                        <MudTextField Label="Password"
                                      Variant="Variant.Outlined"
                                      InputType="InputType.Password"
                                      @bind-Value="model.Password"
                                      For="@(() => model.Password)"
                                      Required="true" />
                    </MudItem>

                    <MudItem xs="12" Class="mt-4">
                        <MudButton ButtonType="ButtonType.Submit"
                                   Variant="Variant.Filled"
                                   Color="Color.Primary"
                                   FullWidth="true"
                                   Size="Size.Large">
                            Sign In
                        </MudButton>
                    </MudItem>

                </MudGrid>
            </EditForm>
        </MudCardContent>

        <MudCardActions Class="d-flex justify-center pa-6 pt-2">
            <MudText Typo="Typo.body2" Class="mud-text-secondary">
                Don't have an account?
                <MudLink Href="/signup" Typo="Typo.body2">Sign Up</MudLink>
            </MudText>
        </MudCardActions>

    </MudCard>
</MudContainer>

@code {
    [SupplyParameterFromForm(FormName = "LoginForm")]
    public LoginDTO model { get; set; } = new();

    public class LoginDTO
    {
        [Required(ErrorMessage = "Username is required")]
        [EmailAddress(ErrorMessage = "Please enter a valid email address")]
        public string Username { get; set; }

        [Required(ErrorMessage = "Password is required")]
        public string Password { get; set; }
    }
}